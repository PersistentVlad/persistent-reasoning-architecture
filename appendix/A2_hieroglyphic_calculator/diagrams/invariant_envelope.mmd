%% File: persistent-reasoning-architecture/appendix/A2_hieroglyphic_calculator/diagrams/invariant_envelope.mmd
%% Purpose: Define the layered invariant envelope that constrains what may persist.

flowchart TB
  subgraph E["Invariant Envelope (Persistent)"]
    A["Axioms / Base invariants"]
    SC["Scope / Applicability"]
    AT["Allowed transformations"]
    FT["Forbidden transformations"]
    RP["Revision protocol<br/>proposal → commit → lineage"]

    A --> AT
    SC --> AT
    A --> FT
    SC --> FT

    RP --> A
    RP --> SC
    RP --> AT
    RP --> FT
  end

  I["Inference / Orchestrator"] -->|navigate / read| E
  I --> CS["Candidate step"]
  CS -->|checked against| E
  E -->|admissible or violation| I

  I -.->|mutate axioms forbidden| A
  I -.->|mutate transforms forbidden| AT
  I -.->|mutate forbidden set forbidden| FT
  I -.->|bypass revision forbidden| RP